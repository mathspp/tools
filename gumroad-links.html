<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gumroad Link Builder</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        :root {
            color-scheme: light dark;
        }

        body {
            max-width: 960px;
            margin: 0 auto;
            padding: clamp(1.5rem, 3vw, 2.75rem) clamp(1rem, 3vw, 2.75rem) clamp(3rem, 4vw, 4rem);
        }

        header {
            margin-bottom: clamp(1.75rem, 3vw, 2.5rem);
        }

        h1 {
            font-size: clamp(2rem, 3.4vw, 2.75rem);
            margin: 0 0 0.45rem;
            color: var(--tx);
        }

        p.lead {
            margin: 0;
            color: var(--tx-2);
            font-size: clamp(1rem, 2.2vw, 1.2rem);
        }

        .layout {
            display: grid;
            gap: clamp(1.5rem, 3vw, 2.5rem);
        }

        form.surface {
            display: grid;
            gap: clamp(1.25rem, 2.5vw, 1.75rem);
            padding: clamp(1.25rem, 2.6vw, 2rem);
        }

        .form-grid {
            display: grid;
            gap: clamp(1rem, 2vw, 1.25rem);
        }

        .field-group {
            display: grid;
            gap: 0.5rem;
        }

        .field-row {
            display: grid;
            gap: 0.75rem;
        }

        .field-row.split {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            align-items: end;
        }

        label {
            font-weight: 600;
        }

        input[type="text"],
        input[type="url"],
        input[type="email"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
        }

        .helper-text {
            margin: 0;
            color: var(--tx-3);
            font-size: 0.92rem;
        }

        .checkbox-stack {
            display: grid;
            gap: 0.75rem;
        }

        .checkbox-stack label {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            font-weight: 500;
        }

        .custom-fields {
            display: grid;
            gap: 0.75rem;
        }

        .custom-field-row {
            display: grid;
            gap: 0.75rem;
        }

        .custom-field-row .pair {
            display: grid;
            gap: 0.5rem;
        }

        @media (min-width: 680px) {
            .custom-field-row {
                grid-template-columns: minmax(180px, 1fr) minmax(200px, 1fr) auto;
                align-items: end;
            }

            .custom-field-row .pair {
                gap: 0.35rem;
            }
        }

        .custom-field-row button {
            align-self: center;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .results.surface {
            padding: clamp(1.25rem, 2.6vw, 2rem);
            display: grid;
            gap: 1rem;
        }

        #generated-link {
            font-family: var(--mono-font, "SFMono-Regular", "Menlo", "Consolas", "Liberation Mono", "Courier New", monospace);
            min-height: 3.2rem;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            text-align: left;
            padding: 0.65rem 0.5rem;
            border-bottom: 1px solid var(--ui-2);
        }

        th {
            font-weight: 600;
            color: var(--tx-2);
        }

        .empty-state {
            margin: 0;
            color: var(--tx-3);
        }

        .sr-only {
            border: 0;
            clip: rect(0 0 0 0);
            height: 1px;
            margin: -1px;
            overflow: hidden;
            padding: 0;
            position: absolute;
            width: 1px;
        }

        @media (min-width: 920px) {
            .layout {
                grid-template-columns: 1fr minmax(260px, 320px);
            }

            .results.surface {
                height: fit-content;
                position: sticky;
                top: clamp(1.5rem, 4vw, 3rem);
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Gumroad Link Builder</h1>
        <p class="lead">Compose Gumroad product URLs with optional checkout parameters to prefill your customerâ€™s
            experience.</p>
    </header>

    <div class="layout">
        <form id="gumroad-form" class="surface" autocomplete="off">
            <div class="form-grid">
                <div class="field-group">
                    <label for="product-url">Product URL</label>
                    <input type="url" id="product-url" name="product-url" placeholder="https://username.gumroad.com/l/product"
                        required>
                    <p class="helper-text">Start with the exact product link you share from Gumroad. Discount codes can be
                        added below.</p>
                </div>

                <div class="field-group">
                    <label for="discount-code">Discount code (optional)</label>
                    <input type="text" id="discount-code" name="discount-code" placeholder="SUMMER25">
                    <p class="helper-text">Codes are appended to the URL path like <code>/SUMMER25</code>.</p>
                </div>

                <fieldset class="checkbox-stack">
                    <legend>Checkout behaviour</legend>
                    <label for="wanted">
                        <input type="checkbox" id="wanted" name="wanted">
                        Take the customer straight to checkout (<code>wanted=true</code>)
                    </label>
                    <label for="pay_in_installments">
                        <input type="checkbox" id="pay_in_installments" name="pay_in_installments">
                        Prefer the installments option when available (<code>pay_in_installments=true</code>)
                    </label>
                </fieldset>

                <div class="field-group">
                    <label for="frequency">Membership payment frequency</label>
                    <select id="frequency" name="frequency">
                        <option value="">No preference</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="biannually">Biannually</option>
                        <option value="yearly">Yearly</option>
                    </select>
                    <p class="helper-text">Adds <code>?monthly=true</code>, <code>?yearly=true</code>, and so on.</p>
                </div>

                <div class="field-group">
                    <label for="variant">Variant / version / tier</label>
                    <input type="text" id="variant" name="variant" placeholder="Professional">
                    <p class="helper-text">Links to a specific variant via <code>variant=</code>. The value will be URL encoded for
                        you.</p>
                </div>

                <div class="field-row split">
                    <div class="field-group">
                        <label for="price">Pay-what-you-want price</label>
                        <input type="number" id="price" name="price" min="0" step="0.01" placeholder="20">
                    </div>
                    <div class="field-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" name="quantity" min="1" step="1" placeholder="1">
                    </div>
                </div>

                <div class="field-row split">
                    <div class="field-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" placeholder="customer@example.com">
                    </div>
                    <div class="field-group">
                        <label for="referrer">Referrer</label>
                        <input type="url" id="referrer" name="referrer" placeholder="https://twitter.com">
                    </div>
                </div>

                <section class="field-group">
                    <div class="field-row">
                        <div>
                            <h2 style="margin: 0; font-size: 1.1rem;">Custom checkout fields</h2>
                            <p class="helper-text">Provide the exact label from your Gumroad custom field to prefill it. Only rows
                                with both a label and value are added.</p>
                        </div>
                        <div class="actions">
                            <button type="button" id="add-custom-field">Add custom field</button>
                        </div>
                    </div>
                    <div id="custom-fields" class="custom-fields" aria-live="polite"></div>
                </section>
            </div>

            <div class="actions">
                <button type="reset">Reset</button>
            </div>
        </form>

        <section class="surface results" aria-live="polite">
            <div>
                <h2>Generated link</h2>
                <textarea id="generated-link" readonly placeholder="Your URL will appear here"></textarea>
            </div>
            <div class="actions">
                <button type="button" id="copy-button" disabled>Copy link</button>
            </div>
            <div>
                <h3 style="margin: 0; font-size: 1.1rem;">Included parameters</h3>
                <div class="table-container">
                    <table aria-describedby="parameters-description">
                        <thead>
                            <tr>
                                <th scope="col">Parameter</th>
                                <th scope="col">Value</th>
                            </tr>
                        </thead>
                        <tbody id="parameters-body">
                            <tr>
                                <td colspan="2">
                                    <p class="empty-state" id="parameters-description">No query parameters yet. Fill in the
                                        form to generate them.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <template id="custom-field-template">
        <div class="custom-field-row">
            <div class="pair">
                <label class="sr-only" data-role="name-label">Custom field label</label>
                <input type="text" data-role="custom-name" placeholder="Custom field label">
            </div>
            <div class="pair">
                <label class="sr-only" data-role="value-label">Custom field value</label>
                <input type="text" data-role="custom-value" placeholder="Prefilled value">
            </div>
            <button type="button" class="remove-field">Remove</button>
        </div>
    </template>

    <script>
        (function () {
            const form = document.getElementById('gumroad-form');
            const output = document.getElementById('generated-link');
            const copyButton = document.getElementById('copy-button');
            const paramsTableBody = document.getElementById('parameters-body');
            const customFieldsContainer = document.getElementById('custom-fields');
            const addCustomFieldButton = document.getElementById('add-custom-field');
            const template = document.getElementById('custom-field-template');

            let customFieldCount = 0;

            function normaliseBaseUrl(url) {
                return url.replace(/\s+/g, '').replace(/\/+$/, '');
            }

            function buildLink() {
                const formData = new FormData(form);
                const rawUrl = (formData.get('product-url') || '').trim();

                if (!rawUrl) {
                    output.value = '';
                    copyButton.disabled = true;
                    paramsTableBody.innerHTML = `
                        <tr>
                            <td colspan="2">
                                <p class="empty-state">No query parameters yet. Fill in the form to generate them.</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                let baseUrl = normaliseBaseUrl(rawUrl);
                const discountCode = (formData.get('discount-code') || '').trim();
                if (discountCode) {
                    baseUrl = `${baseUrl}/${encodeURIComponent(discountCode)}`;
                }

                const params = new URLSearchParams();

                if (formData.get('wanted')) {
                    params.set('wanted', 'true');
                }

                if (formData.get('pay_in_installments')) {
                    params.set('pay_in_installments', 'true');
                }

                const frequency = formData.get('frequency');
                if (frequency) {
                    params.set(frequency, 'true');
                }

                const variant = (formData.get('variant') || '').trim();
                if (variant) {
                    params.set('variant', variant);
                }

                const email = (formData.get('email') || '').trim();
                if (email) {
                    params.set('email', email);
                }

                const price = (formData.get('price') || '').trim();
                if (price) {
                    params.set('price', price);
                }

                const quantity = (formData.get('quantity') || '').trim();
                if (quantity) {
                    params.set('quantity', quantity);
                }

                const referrer = (formData.get('referrer') || '').trim();
                if (referrer) {
                    params.set('referrer', referrer);
                }

                const customFieldRows = customFieldsContainer.querySelectorAll('.custom-field-row');
                customFieldRows.forEach((row) => {
                    const nameInput = row.querySelector('[data-role="custom-name"]');
                    const valueInput = row.querySelector('[data-role="custom-value"]');
                    const name = nameInput.value.trim();
                    const value = valueInput.value.trim();
                    if (name && value) {
                        params.set(name, value);
                    }
                });

                const queryString = params.toString();
                let finalUrl = baseUrl;
                if (queryString) {
                    if (/[?&]$/.test(baseUrl)) {
                        finalUrl = `${baseUrl}${queryString}`;
                    } else {
                        const separator = baseUrl.includes('?') ? '&' : '?';
                        finalUrl = `${baseUrl}${separator}${queryString}`;
                    }
                }

                output.value = finalUrl;
                copyButton.disabled = !finalUrl;
                if (copyButton.disabled) {
                    copyButton.textContent = 'Copy link';
                }

                if (queryString) {
                    const rows = Array.from(params.entries()).map(([key, value]) => `
                        <tr>
                            <td><code>${key}</code></td>
                            <td><code>${value}</code></td>
                        </tr>
                    `);
                    paramsTableBody.innerHTML = rows.join('');
                } else {
                    paramsTableBody.innerHTML = `
                        <tr>
                            <td colspan="2">
                                <p class="empty-state">No query parameters included.</p>
                            </td>
                        </tr>
                    `;
                }
            }

            function addCustomField() {
                const clone = template.content.firstElementChild.cloneNode(true);
                customFieldCount += 1;
                const nameInput = clone.querySelector('[data-role="custom-name"]');
                const valueInput = clone.querySelector('[data-role="custom-value"]');
                const nameLabel = clone.querySelector('[data-role="name-label"]');
                const valueLabel = clone.querySelector('[data-role="value-label"]');
                const nameId = `custom-name-${customFieldCount}`;
                const valueId = `custom-value-${customFieldCount}`;

                nameInput.id = nameId;
                valueInput.id = valueId;
                nameLabel.setAttribute('for', nameId);
                valueLabel.setAttribute('for', valueId);

                customFieldsContainer.appendChild(clone);
                buildLink();
                nameInput.focus();
            }

            function handleCustomFieldInteraction(event) {
                if (event.target.classList.contains('remove-field')) {
                    event.preventDefault();
                    const row = event.target.closest('.custom-field-row');
                    if (row) {
                        row.remove();
                        buildLink();
                    }
                }
            }

            form.addEventListener('input', buildLink);
            form.addEventListener('change', buildLink);
            form.addEventListener('reset', () => {
                window.setTimeout(() => {
                    customFieldsContainer.innerHTML = '';
                    buildLink();
                }, 0);
            });

            addCustomFieldButton.addEventListener('click', (event) => {
                event.preventDefault();
                addCustomField();
            });

            customFieldsContainer.addEventListener('click', handleCustomFieldInteraction);

            customFieldsContainer.addEventListener('input', () => {
                buildLink();
            });

            copyButton.addEventListener('click', async () => {
                const text = output.value.trim();
                if (!text) {
                    return;
                }

                try {
                    await navigator.clipboard.writeText(text);
                    copyButton.textContent = 'Copied!';
                    window.setTimeout(() => {
                        copyButton.textContent = 'Copy link';
                    }, 1500);
                } catch (error) {
                    output.focus();
                    output.select();
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            copyButton.textContent = 'Copied!';
                            window.setTimeout(() => {
                                copyButton.textContent = 'Copy link';
                            }, 1500);
                        }
                    } catch (fallbackError) {
                        console.error('Copy failed', fallbackError);
                    }
                }
            });

            // Initialise state on load
            buildLink();
        })();
    </script>
</body>

</html>
